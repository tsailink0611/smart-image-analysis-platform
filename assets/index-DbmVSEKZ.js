var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{r as s,g as r,a}from"./vendor-Z2Iecplj.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var n,i,l={exports:{}},o={};var d=(i||(i=1,l.exports=function(){if(n)return o;n=1;var e=s(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,s,r){var n,o={},d=null,c=null;for(n in void 0!==r&&(d=""+r),void 0!==s.key&&(d=""+s.key),void 0!==s.ref&&(c=s.ref),s)a.call(s,n)&&!l.hasOwnProperty(n)&&(o[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===o[n]&&(o[n]=s[n]);return{$$typeof:t,type:e,key:d,ref:c,props:o,_owner:i.current}}return o.Fragment=r,o.jsx=d,o.jsxs=d,o}()),l.exports),c=s();const m=r(c);var x,u={};var p=function(){if(x)return u;x=1;var e=a();return u.createRoot=e.createRoot,u.hydrateRoot=e.hydrateRoot,u}();const h=({onFileUploaded:e,isAnalyzing:t})=>{const[s,r]=c.useState(!1),[a,n]=c.useState(null),i=c.useRef(null),l=async t=>{if(!t.type.startsWith("image/")&&"application/pdf"!==t.type)return void alert("画像ファイルまたはPDFファイルを選択してください");const s=URL.createObjectURL(t),r=await new Promise(e=>{const s=new FileReader;s.onload=t=>{var s;return e(null==(s=t.target)?void 0:s.result)},s.readAsDataURL(t)}),a={file:t,previewUrl:s,base64Data:r};n(a),e(a)};return d.jsx("div",{className:"space-y-4",children:a?d.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:d.jsxs("div",{className:"flex items-start space-x-4",children:[d.jsx("div",{className:"flex-shrink-0",children:a.file.type.startsWith("image/")?d.jsx("img",{src:a.previewUrl,alt:"アップロード画像",className:"w-24 h-24 object-cover rounded-lg"}):d.jsx("div",{className:"w-24 h-24 bg-red-100 rounded-lg flex items-center justify-center",children:d.jsx("span",{className:"text-2xl",children:"📄"})})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("h4",{className:"font-medium text-gray-900 truncate",children:a.file.name}),d.jsxs("p",{className:"text-sm text-gray-500",children:[(a.file.size/1024).toFixed(1)," KB"]}),d.jsx("p",{className:"text-sm text-gray-500",children:a.file.type})]}),d.jsx("button",{onClick:()=>{a&&URL.revokeObjectURL(a.previewUrl),n(null)},disabled:t,className:"text-red-500 hover:text-red-700 disabled:opacity-50",children:"🗑️"})]})}):d.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer ${s?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} ${t?"opacity-50 pointer-events-none":"hover:bg-gray-50"}`,onDrop:e=>{e.preventDefault(),r(!1);const t=e.dataTransfer.files[0];t&&l(t)},onDragOver:e=>{e.preventDefault(),r(!0)},onDragLeave:e=>{e.preventDefault(),r(!1)},onClick:e=>{e.preventDefault(),console.log("Upload area clicked"),!t&&i.current&&i.current.click()},children:[d.jsxs("div",{className:"space-y-4",children:[d.jsx("div",{className:"text-6xl text-gray-400",children:"📁"}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"画像・文書をアップロード"}),d.jsx("p",{className:"text-gray-500 text-sm",children:"ファイルをドラッグ&ドロップするか、クリックして選択"}),d.jsx("p",{className:"text-gray-400 text-xs mt-2",children:"対応形式: PNG, JPG, PDF, WebP, BMP, TIFF"})]})]}),d.jsx("input",{ref:i,type:"file",accept:"image/*,.pdf,image/webp,image/bmp,image/tiff",onChange:e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&(console.log("File selected:",s.name,s.type,s.size),l(s)),i.current&&(i.current.value="")},className:"hidden",disabled:t,multiple:!1})]})})},g=[{id:"general",title:"📋 一般的な分析",description:"画像・文書の内容を包括的に分析",prompt:"この画像・文書を日本語で分析し、内容を要約してください。重要なポイントを整理して教えてください。"},{id:"business",title:"💼 ビジネス文書分析",description:"契約書、請求書、報告書などの分析",prompt:"このビジネス文書を分析し、重要な情報（金額、日付、当事者、条件など）を抽出して整理してください。"},{id:"data",title:"📊 データ・表分析",description:"表、グラフ、データの構造化",prompt:"この画像に含まれるデータや表を分析し、数値やトレンド、重要な洞察を日本語で説明してください。"},{id:"technical",title:"🔧 技術文書分析",description:"エラー画面、ログ、技術的内容の分析",prompt:"この技術的な内容を分析し、問題の特定、原因の推測、解決策の提案を日本語で行ってください。"},{id:"custom",title:"✏️ カスタム分析",description:"独自の指示で分析実行",prompt:""}],f=({onStartAnalysis:e,isAnalyzing:t,hasFile:s})=>{const[r,a]=m.useState("general"),[n,i]=m.useState("");return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"🤖 AI分析タイプを選択"}),d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:g.map(e=>d.jsx("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors "+(r===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>a(e.id),children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx("input",{type:"radio",checked:r===e.id,onChange:()=>a(e.id),className:"mt-1"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]})},e.id))})]}),"custom"===r&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カスタム分析指示"}),d.jsx("textarea",{value:n,onChange:e=>i(e.target.value),placeholder:"どのような分析を行いたいか、具体的に指示してください...",rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:()=>{const t=g.find(e=>e.id===r);if(!t)return;let s=t.prompt;"custom"===r&&n&&(s=n),s.trim()?e(s):alert("分析指示を入力してください")},disabled:!s||t,className:"px-8 py-3 rounded-lg font-medium transition-colors "+(!s||t?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:t?d.jsxs("div",{className:"flex items-center space-x-2",children:[d.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),d.jsx("span",{children:"Claude 4 Sonnet 分析中..."})]}):"🚀 AI分析を開始"})})]})},y=({result:e,isLoading:t})=>{const[s,r]=c.useState("text");if(t)return d.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md",children:d.jsxs("div",{className:"flex items-center justify-center py-12",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),d.jsx("span",{className:"ml-3 text-gray-600",children:"分析処理中..."})]})});if(!e)return d.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg text-center",children:[d.jsx("div",{className:"text-4xl mb-4 text-gray-400",children:"📊"}),d.jsx("p",{className:"text-gray-500",children:"分析結果がここに表示されます"})]});const a=e=>{navigator.clipboard.writeText(e).then(()=>alert("クリップボードにコピーしました")).catch(()=>alert("コピーに失敗しました"))};return d.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[d.jsx("div",{className:"border-b border-gray-200",children:d.jsxs("nav",{className:"flex",children:[d.jsx("button",{onClick:()=>r("text"),className:"px-6 py-3 font-medium text-sm border-b-2 transition-colors "+("text"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"📄 抽出テキスト"}),d.jsx("button",{onClick:()=>r("analysis"),className:"px-6 py-3 font-medium text-sm border-b-2 transition-colors "+("analysis"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"🤖 Claude 4 分析"}),d.jsx("button",{onClick:()=>r("metadata"),className:"px-6 py-3 font-medium text-sm border-b-2 transition-colors "+("metadata"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),children:"ℹ️ メタデータ"})]})}),d.jsxs("div",{className:"p-6",children:["text"===s&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h3",{className:"font-semibold text-gray-800",children:"抽出されたテキスト"}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsxs("span",{className:"text-sm text-gray-500",children:["信頼度: ",e.confidence.toFixed(1),"%"]}),d.jsx("button",{onClick:()=>a(e.extractedText),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"📋 コピー"})]})]}),d.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto",children:d.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-700",children:e.extractedText||"テキストが検出されませんでした"})}),d.jsxs("div",{className:"text-sm text-gray-500",children:["文字数: ",e.extractedText.length,"文字"]})]}),"analysis"===s&&d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h3",{className:"font-semibold text-gray-800",children:"🤖 Claude 4 Sonnet 分析結果"}),d.jsx("button",{onClick:()=>a(e.analysis),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"📋 コピー"})]}),d.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg border-l-4 border-blue-500",children:d.jsx("div",{className:"prose prose-sm max-w-none",children:d.jsx("div",{className:"whitespace-pre-wrap text-gray-800 leading-relaxed",children:e.analysis})})}),d.jsxs("div",{className:"bg-gray-50 p-3 rounded text-xs text-gray-600 flex items-center",children:[d.jsx("span",{className:"inline-block w-3 h-3 bg-blue-500 rounded-full mr-2"}),"この分析はClaude 4 Sonnetによる高精度AI分析結果です"]})]}),"metadata"===s&&d.jsxs("div",{className:"space-y-4",children:[d.jsx("h3",{className:"font-semibold text-gray-800",children:"ファイル情報"}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[d.jsx("dt",{className:"font-medium text-gray-600",children:"ファイルサイズ"}),d.jsxs("dd",{className:"text-gray-800",children:[e.metadata.fileSize?(e.metadata.fileSize/1024).toFixed(1):"不明"," KB"]})]}),d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[d.jsx("dt",{className:"font-medium text-gray-600",children:"ファイル形式"}),d.jsx("dd",{className:"text-gray-800",children:e.metadata.fileType||"不明"})]}),e.metadata.dimensions&&d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[d.jsx("dt",{className:"font-medium text-gray-600",children:"画像サイズ"}),d.jsxs("dd",{className:"text-gray-800",children:[e.metadata.dimensions.width," × ",e.metadata.dimensions.height," px"]})]}),d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[d.jsx("dt",{className:"font-medium text-gray-600",children:"処理日時"}),d.jsx("dd",{className:"text-gray-800",children:(new Date).toLocaleString("ja-JP")})]})]})]}),d.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 flex space-x-3",children:[d.jsx("button",{onClick:()=>{const t=`抽出テキスト:\n${e.extractedText}\n\n分析結果:\n${e.analysis}`,s=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`analysis-result-${(new Date).toISOString().slice(0,19)}.txt`,a.click(),URL.revokeObjectURL(r)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"💾 結果をダウンロード"}),d.jsx("button",{onClick:()=>a(`抽出テキスト:\n${e.extractedText}\n\n分析結果:\n${e.analysis}`),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"📋 全体をコピー"})]})]})]})};function b(){return d.jsxs("header",{className:"text-center mb-12",children:[d.jsxs("div",{className:"flex items-center justify-center mb-4",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center text-2xl text-white mr-4",children:"🤖"}),d.jsx("h1",{className:"text-4xl font-bold text-gray-800",children:"Smart Image Analysis Platform"})]}),d.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Claude Sonnet 4を活用した高精度画像・文書分析システム"}),d.jsxs("div",{className:"mt-4 inline-flex items-center px-4 py-2 bg-blue-100 rounded-full text-blue-800 text-sm font-medium",children:[d.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2 animate-pulse"}),"Powered by Claude Sonnet 4"]})]})}function j(){return d.jsx("footer",{className:"mt-16 text-center text-gray-500 text-sm",children:d.jsxs("div",{className:"border-t border-gray-200 pt-8",children:[d.jsx("p",{children:"© 2024 Smart Image Analysis Platform. Powered by Claude Sonnet 4."}),d.jsx("p",{className:"mt-2",children:"OCR + AI分析による次世代文書解析システム"})]})})}const N=new class{constructor(){t(this,"isDevelopment",!1)}formatMessage(e,t,s){if(!this.isDevelopment&&"debug"===e)return;const r=`[${(new Date).toISOString()}] [${e.toUpperCase()}]`;if(s){const a=JSON.stringify(s);console["debug"===e?"log":e](`${r} ${t}`,a)}else console["debug"===e?"log":e](`${r} ${t}`)}debug(e,t){this.formatMessage("debug",e,t)}info(e,t){this.formatMessage("info",e,t)}warn(e,t){this.formatMessage("warn",e,t)}error(e,t,s){const r=t?{...s,error:{message:t.message,stack:t.stack}}:s;this.formatMessage("error",e,r)}},v=new Map;class w extends Error{constructor(e,s="UNKNOWN",r,a,n){super(e),t(this,"type"),t(this,"code"),t(this,"statusCode"),t(this,"context"),this.name="SmartImageError",this.type=s,this.code=r,this.statusCode=a,this.context=n}}const S=(e,t,s)=>new w(e,"VALIDATION","VALIDATION_ERROR",400,{field:t,...s}),O=(e,t)=>new w(e,"PERMISSION","PERMISSION_ERROR",403,t);function R(){const[e,t]=c.useState(null),[s,r]=c.useState(null),[a,n]=c.useState("idle");return{uploadedFile:e,setUploadedFile:t,result:s,status:a,startAnalysis:async(t,s)=>{if(!e)throw S("画像ファイルをアップロードしてください");if(!((e,t=1e3)=>"string"==typeof e&&(!(e.length>t)&&(!/<script|javascript:|data:text\/html|vbscript:/i.test(e)||(N.warn("Potential script injection detected",{component:"security",operation:"validateTextInput",inputLength:e.length}),!1))))(s,500))throw S("指示文に不正な文字が含まれているか、長すぎます");if(!((e,t=10,s=6e4)=>{const r=Date.now(),a=v.get(e);return!a||r>a.resetTime?(v.set(e,{count:1,resetTime:r+s}),!0):a.count>=t?(N.warn("Rate limit exceeded",{component:"security",operation:"checkRateLimit",identifier:e,count:a.count,maxRequests:t}),!1):(a.count++,!0)})("user-session",5,6e4))throw O("リクエスト回数が上限を超えました。しばらく時間をおいてからお試しください");n("processing"),r(null);const a=(s||"この画像・文書を詳細に分析してください。").replace(/[<>"'&]/g,"").trim().substring(0,1e3);const i={prompt:a,image_data:e.base64Data.split(",")[1]||e.base64Data,analysisType:t,customInstructions:a,filename:e.file.name,fileSize:e.file.size,fileType:"image",mimeType:e.file.type};try{const t=await fetch("https://rzddt4m5k6mllt2kkl7xa7rokm0urcjs.lambda-url.us-east-1.on.aws/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();r({extractedText:s.result||s.extractedText||"",confidence:s.confidence||95,analysis:s.result||s.analysis||"",metadata:{fileSize:e.file.size,fileType:e.file.type,dimensions:s.dimensions,processingTime:s.processingTime}}),n("completed")}catch(l){((e,t,s)=>{const r=e;switch(N.error(`Error in ${t}.${s}`,e,{component:t,operation:s,errorType:r.type||"UNKNOWN",errorCode:r.code,statusCode:r.statusCode,context:r.context}),r.type){case"NETWORK":return"ネットワークエラーが発生しました。インターネット接続を確認してください。";case"VALIDATION":return`入力エラー: ${e.message}`;case"UPLOAD":return`ファイルアップロードエラー: ${e.message}`;case"ANALYSIS":return"画像分析中にエラーが発生しました。しばらく時間をおいて再度お試しください。";case"PERMISSION":return"この操作を実行する権限がありません。";default:;}})(l instanceof Error?l:new Error(String(l)),"useImageAnalysis","startAnalysis"),r({extractedText:"",confidence:0,analysis:`分析に失敗しました: ${l instanceof Error?l.message:"不明なエラー"}`,metadata:{fileSize:e.file.size,fileType:e.file.type}}),n("error")}},resetAnalysis:()=>{r(null),n("idle")}}}function k(){const{uploadedFile:e,setUploadedFile:t,result:s,status:r,startAnalysis:a,resetAnalysis:n}=R();return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:d.jsxs("div",{className:"container mx-auto px-4 py-8",children:[d.jsx(b,{}),d.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[d.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[d.jsx("span",{className:"text-2xl mr-3",children:"📁"}),"ファイルアップロード"]}),d.jsx(h,{onFileUploaded:e=>{t(e),n()},isAnalyzing:"processing"===r})]}),d.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[d.jsx("span",{className:"text-2xl mr-3",children:"⚙️"}),"分析設定"]}),d.jsx(f,{onStartAnalysis:e=>(async(e,t)=>{try{await a(e,t)}catch(s){alert(s instanceof Error?s.message:"不明なエラー")}})("custom",e),isAnalyzing:"processing"===r,hasFile:!!e})]}),("processing"===r||s)&&d.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[d.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[d.jsx("span",{className:"text-2xl mr-3",children:"📊"}),"分析結果"]}),d.jsx(y,{result:s,isLoading:"processing"===r})]})]}),d.jsx(j,{})]})})}p.createRoot(document.getElementById("root")).render(d.jsx(c.StrictMode,{children:d.jsx(k,{})}));
